<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>URL shortener - Protected link</title>
    <meta
      name="description"
      content="URL shortener - Provide the password for the protected link"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
      integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk"
      crossorigin="anonymous"
    />
  </head>
  <body class="d-flex align-items-center justify-content-center vh-100">
    <div
      class="d-flex flex-column justify-content-center align-items-center m-4 mt-4 mb-4 w-100"
      style="max-width: 800px;"
    >
      <h1 class="display-4 text-center">URL shortener</h1>
      <p class="text-center lead mt-5">Enter a URL</p>

      <form id="form" class="form-row justify-content-center w-100" novalidate>
        <div class="col-10 mt-2">
          <input
            class="form-control mr-2"
            id="destination"
            name="destination"
            type="url"
            required
          />
          <div class="invalid-feedback">
            Please enter a valid url
          </div>
        </div>
        <div class="col-auto mt-2">
          <button class="btn btn-primary" type="submit">Shorten</button>
        </div>
      </form>

      <div class="position-relative mt-4 w-100">
        <div
          id="success"
          class="alert alert-success p-2 pl-4 pr-4 position-absolute mw-100 m-auto"
          style="visibility: hidden; width: fit-content; left: 0; right: 0;"
        >
          <a id="shortLink" class="stretched-link h6" target="_blank"></a>
        </div>
        <div
          id="error"
          class="alert alert-danger p-2 pl-4 pr-4 position-absolute mw-100 m-auto"
          style="visibility: hidden; width: fit-content; left: 0; right: 0;"
        ></div>
      </div>
    </div>

    <script>
      var form = document.getElementById("form");
      var input = document.getElementById("destination");
      var error = document.getElementById("error");
      var success = document.getElementById("success");
      var shortLink = document.getElementById("shortLink");

      input.oninput = function () {
        form.classList.remove("was-validated");
        success.style.visibility = "hidden";
        error.style.visibility = "hidden";
      };

      form.onsubmit = function (e) {
        e.preventDefault();
        form.classList.add("was-validated");
        if (form.checkValidity()) {
          fetch("/create-link", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              destination: input.value,
            }),
          }).then(function (res) {
            res.json().then(function (json) {
              if (res.ok) {
                success.style.visibility = "visible";
                shortLink.innerText = json.link;
                shortLink.setAttribute("href", json.link);
              } else {
                error.style.visibility = "visible";
                error.innerText = json.message;
              }
            });
          });
        }
      };
    </script>
  </body>
</html>
